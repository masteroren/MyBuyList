function ShowList(){var r=$("#ingredientsContainer"),t,n,i,u,f,e,o,s;for(r.html(""),t=0;t<ingridiantsApi.Length();t++)n=ingridiantsApi.GetItem(t),n.DisplayIngredient=n.FractionDisplay+n.q+" "+n.MeasureUnitName+" "+n.FoodName,i=$("<div/>").addClass("row").attr("data-id",t),u=$("<a />").html("עדכן").addClass("listBtn").addClass("updateBtn").addClass("modifyBtn").addClass("col").attr("data-id",t),i.append(u),f=$("<a />").html("מחק").addClass("listBtn").addClass("deleteBtn").addClass("deleteBtn").addClass("col").attr("data-id",t),i.append(f),e=$("<span />").html(n.DisplayIngredient).addClass("floatRight").addClass("col"),i.append(e),o=$("<span />").html(n.Remarks).addClass("floatRight"),i.append(o),r.append(i);s=JSON.stringify(ingridiantsApi.GetList());$("#hfIngridiants").val(s);initEvents()}function InitIngediantsControl(){ingridiantsApi||(ingridiantsApi=new IngridiantsApi)}function ShowSavedListIngridiant(n){ingridiantsApi||(ingridiantsApi=new IngridiantsApi);ingridiantsApi.SetList(n);ShowList()}function initEvents(){$(".modifyBtn").click(function(){var t=$(this).attr("data-id"),n=ingridiantsApi.GetItem(t);$("#mode").val("update");$("#selectedIndex").val(t);$("#txtQuantity").val(n.q);$("#"+fractionClientId).val(n.f);$("#ingridiantName").val(n.FoodName);$("#"+foodRemarkClientId).val(n.Remarks);$("#"+unitClientId).val(n.MeasurementUnitId);$("#ingridiantId").val(n.FoodId);$("#addIngridiant").hide();$("#updateIngridiant").show()});$(".deleteBtn").click(function(){var n=$(this).attr("data-id"),t;ingridiantsApi.Delete(n);$(".row[data-id="+n+"]").hide();t=JSON.stringify(ingridiantsApi.GetList());$("#hfIngridiants").val(t);ShowList()})}function OnClientItemSelected(n,t){var i=t._value.Second;$("#"+hfSelectedIngridiantClientId).val(i)}function OnClientShowing(n){for(var i,u,r=n.get_completionList(),t=0;t<r.childNodes.length;t++)i=r.childNodes[t],u=i._value.First,i.innerText=u}var ingridiantsContainer,IngridiantsApi=function(){var n=[];this.SelectedIngrediant;this.Length=function(){return n.length};this.getIngridiants=function(n){var t=$("#ingridiantsList"),i;if(n.length<3){t.text("").hide();return}i=$("#apiUrl").val()+"/api/foods";$.get(i,{searchQuery:n},function(n){n.results&&(t.text(""),$.each(n.results,function(n,i){var r=$("<div/>",{"class":"ingridiant-list-item"}).appendTo(t);$("<span/>",{text:i.FoodName}).appendTo(r);$("<input/>",{type:"hidden",value:i.FoodId}).appendTo(r)}),t.show(),$(".ingridiant-list-item").click(function(){var n=$(this).children("input").val(),i=$(this).children("span").text();$("#ingridiantName").val(i);$("#ingridiantId").val(n);t.hide()}))},"json")};this.Exists=function(t){for(var i=0;i<n.length;i++)if(n[i].Id===t.Id)return!0;return!1};this.IndexOf=function(t){for(var i=0;i<n.length;i++)if(n[i].Id===t)return i;return-1};this.Add=function(t){n.push(t)};this.Update=function(t,i){n[i].FoodId=t.FoodId;n[i].Quantity=t.Quantity;n[i].FractionDisplay=t.FractionDisplay;n[i].MeasurementUnitId=t.MeasurementUnitId;n[i].MeasureUnitName=t.MeasureUnitName;n[i].Remarks=t.Remarks;n[i].FoodName=t.FoodName;n[i].DisplayIngredient=t.DisplayIngredient};this.Delete=function(t){n.splice(t,1)};this.GetItem=function(t){return n[t]};this.GetList=function(){return n};this.SetList=function(n){for(var i,t=0;t<n.length;t++)i=new Ingridiant,i.IngredientId=n[t].IngredientId,i.FoodId=n[t].FoodId,i.FoodName=n[t].FoodName,i.MeasurementUnitId=n[t].MeasurementUnitId,i.MeasureUnitName=n[t].MeasureUnitName,i.Quantity=n[t].Quantity,i.FractionDisplay=n[t].FractionDisplay,i.Remarks=n[t].Remarks,i.q=parseInt(n[t].Quantity),i.f=n[t].Quantity-i.q,this.Add(i)}},Ingridiant=function(){this.IngredientId;this.RecipeId;this.FoodId;this.FoodName;this.MeasurementUnitId;this.MeasurementUnitName;this.Quantity;this.Remarks;this.CompleteValue;this.FractionValue;this.FractionDisplay;this.DisplayIngredient;this.DecimalSeperator;this.q;this.f;this.IsValid=function(){return this.Quantity!==""&&this.FoodId!==""}},ingridiantsApi,recipeId;$(document).ready(function(){InitIngediantsControl();var n=$("#hfIngridiants").val();n!==""&&ShowSavedListIngridiant(JSON.parse(n));recipeId=$("#hfRecipeId").val()===""?-1:$("#hfRecipeId").val();$("#updateIngridiant").hide();$("#ingridiantName").keyup(function(){var n=$("#ingridiantName").val();ingridiantsApi.getIngridiants(n)});$("#addIngridiant").mousedown(function(){$(this).css("background-image",'url("Images/btn_AddProduct_down.png")')});$("#addIngridiant").mouseup(function(){$(this).css("background-image",'url("Images/btn_AddProduct_over.png")')});$("#addIngridiant").mouseout(function(){$(this).css("background-image",'url("Images/btn_AddProduct_up.png")')});$("#addIngridiant").mouseover(function(){$(this).css("background-image",'url("Images/btn_AddProduct_over.png")')});$("#addIngridiant, #updateIngridiant").click(function(){var i=$("#mode").val(),n,t;switch(i){case"update":t=$("#selectedIndex").val();n=ingridiantsApi.GetItem(t);break;default:n=new Ingridiant;n.IngredientId=$("#ingridiantId").val()}if(n.RecipeId=recipeId,n.q=parseFloat($("#txtQuantity").val()),n.f=$("#"+fractionClientId+" option:selected").val()?parseFloat($("#"+fractionClientId+" option:selected").val().replace(",",".")):0,n.Quantity=n.q+n.f,n.FractionDisplay=$("#"+fractionClientId+" option:selected").text(),n.MeasureUnitName=$("#"+unitClientId+" option:selected").text(),n.MeasurementUnitId=$("#"+unitClientId).val(),n.FoodId=$("#ingridiantId").val(),n.FoodName=$("#ingridiantName").val(),n.Remarks=$("#"+foodRemarkClientId).val(),n.IsValid()){switch(i){case"update":ingridiantsApi.Update(n,t);break;default:ingridiantsApi.Add(n)}ShowList();$("#txtQuantity").val("");$("#"+fractionClientId).val("");$("#ingridiantName").val("");$("#"+foodRemarkClientId).val("");$("#addIngridiant").show();$("#updateIngridiant").hide();$("#mode").val("")}});$("#updateIngridiant").mousedown(function(){$(this).css("background-image",'url("Images/btn_EditProduct_down.png")')});$("#updateIngridiant").mouseup(function(){$(this).css("background-image",'url("Images/btn_EditProduct_over.png")')});$("#updateIngridiant").mouseout(function(){$(this).css("background-image",'url("Images/btn_EditProduct_up.png")')});$("#updateIngridiant").mouseover(function(){$(this).css("background-image",'url("Images/btn_EditProduct_over.png")')})});